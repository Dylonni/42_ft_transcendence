

vault secrets enable pki

vault secrets tune -max-lease-ttl=87600h pki

vault write -field=certificate pki/root/generate/internal common_name="localhost" issuer_name="root_2024" ttl=87600h > root_2024_ca.
crt

vault list pki/issuers/
	=> save the key, output is sth like below
Keys
----
28447aa4-e315-b346-6269-b45e127c55bb

vault read pki/issuer/$(vault list -format=json pki/issuers/ | jq -r '.[]') \
 | tail -n 6

vault write pki/roles/2024-servers allow_any_name=true


vault write pki/config/urls \
     issuing_certificates="$VAULT_ADDR/v1/pki/ca" \
     crl_distribution_points="$VAULT_ADDR/v1/pki/crl"

vault secrets enable -path=pki_int pki

vault secrets tune -max-lease-ttl=43800h pki_int

#pki/issuer -> key that was saved
vault pki issue \
      --issuer_name=localhost-intermediate \
      /pki/issuer/28447aa4-e315-b346-6269-b45e127c55bb \
      /pki_int/ \
      common_name="localhost Intermediate Authority" \
      o="localhost" \
      ou="education" \
      key_type="rsa" \
      key_bits="4096" \
      max_depth_len=1 \
      permitted_dns_domains="localhost" \
      ttl="43800h"

vault write pki_int/roles/localhost \
     issuer_ref="$(vault read -field=default pki_int/config/issuers)" \
     allowed_domains="localhost" \
     allow_subdomains=true \
     max_ttl="720h"

vault write pki_int/issue/localhost common_name="localhost" ttl="24h"



